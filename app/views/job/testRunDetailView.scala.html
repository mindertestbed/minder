@(testRun: TestRun, localUser: models.User = null)
@import views.html.util._

@main(Messages("minder.navigation.restricted.testdesigner"), "User History View") {
  @dialogs()

  <div style="position:absolute ; top:0 ; left:0 ; bottom:5px ; right:0 ; padding:5px ;">
    <div style="position:absolute ; top:0 ; left:0 ; height:39px ; right:0 ;">
      <h4>Test Run Details</h4>
    </div>
    <div style="position:absolute ; top:40px ; left:0 ; bottom:0 ; width:300px ;">
      <table class="shaded">
        @if(testRun.job != null) {
          <tr>
            <th>Test Group</th><td>
            <a href="/getGroupDetailView?id=@{
              testRun.job.tdl.testCase.testAssertion.testGroup.id
            }&display=assertions">
            @{
              testRun.job.tdl.testCase.testAssertion.testGroup.name
            }
            </a>
          </td>
          </tr>
          <tr>
            <th>Test Assertion</th><td>
            <a href="/getAssertionDetailView?id=@{
              testRun.job.tdl.testCase.testAssertion.id
            }">
            @{
              testRun.job.tdl.testCase.testAssertion.taId
            }
            </a>

          </td>
          </tr>
          <tr>
            <th>Test Case</th><td>
            <a href="/viewTestCase?id=@{
              testRun.job.tdl.testCase.id
            }&display=jobs">
            @{
              testRun.job.tdl.testCase.name
            }
            </a>
          </td>
          </tr>
          <tr>
            <th>Job</th><td>
            <a href="/viewJob?id=@{
              testRun.job.id
            }&showHistory=true">
            @{
              testRun.job.name
            }</a>
          </td>
          </tr>
        }
        <tr>
          <th>User</th><td>@testRun.runner.email</td>
        </tr>
        <tr>
          <th>
            Visibility</th><td id="visibilityTd">@visibilityTagFragment(testRun.visibility, testRun.runner, true, true)</td>
        </tr>
        <tr>
          <th>Date</th><td>@testRun.date</td>
        </tr>
        <tr>
          <th>Report</th><td style="text-align: center">@reportMenu(testRun, false)</td>
        </tr>
      </table>
    </div>
    <div style="position:absolute ; top:40px ; left:305px ; bottom:0 ; right:0 ; padding: 5px ;">
      <label>Log</label>
      <div class="tipitip" style="height:100% ; border:1px solid gray ; border-radius:2px ; overflow: scroll ;">
        <pre>@testRun.history.extractSystemOutputLog()</pre>
      </div>
    </div>
  </div>

  @authentication.subjectIs(testRun.runner) {
    @visibilityEditorFragment("jsRoutes.controllers.JobController.changeTestRunVisibility", testRun.id, testRun.visibility, "visibilityTd")
  }
}
